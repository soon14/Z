<template>
	<div class='addCrm'>
	<!--固定导航-->
		<div class="head">
	
				<div class="left-top">
					<p class="wldw">
						<!-- <span style="width:42px;font-weight:900">{{$t('public.screen')}}：</span>
						 <Select style="width:100px" @on-change="orderselected" v-model='value'>
					        <Option v-for="item in orderTypeList" :value="item.value" :key="item.value">{{ item.label }}</Option>
					    </Select> -->
					</p>
					
				</div>
				<div class="right-top">
				<div style="position:absolute;left:360px">
					<span style="margin-left:40px;font-size:19px;font-weight:900">{{orderno}}</span> 
				</div>
				
					<span @click="cancelHome" style="cursor:pointer;position:absolute;right:140px"><Icon type="close" class="cha" ></Icon></span>
				</div>
		
		</div>
		<!--左侧列表-->
		<div class="left-content">
			<p v-if="AllOrderList.length==0">
				<Spin fix>
	                 <div>{{$t('public.NoData')}}</div>
	            </Spin>
		    </p>
			<Scroll :on-reach-bottom="handleReachEdge" :height="height" v-else>
				<div class="con-list" v-for="(item,index) in AllOrderList" @click="getcginfo(item.id,index)" :class="{bg:numIndex==index}">
					<span style="margin-right: 10px;">
                         <Checkbox :value="numIndex==index"></Checkbox>
						 
                     </span>
					 <div>
						<p class="list-title">{{item.orderNo}}</p>
						<p class="txt" style="margin-top:10px;">
							{{item.customerName}} 
							
						</p>
						<div class="lanrenLeft" :class="{bgd3:item.status==20,bgd4:item.status==35,bgd5:item.status==30,bgd6:item.status==50,bgd7:item.status==10,bgd8:item.status==23,bgd9:item.status==1,bgd9:item.status==0}">
		                    <span >{{item.statusDesc}}</span> 
		                </div>​
		                <span class="date1"><span style='color:#d53c39'>{{item.amount}}</span></span>
					</div>
				</div>
				
			</Scroll>
		</div>
		<!--右侧-->
		<div class="add-right" >
			<div class='right-right' v-if='addTxt'>
				<Form ref="formValidate" :model="formValidate" :rules="ruleValidate" :label-width="100">
					<div style='width:100%;display:flex'>
						<div style='width:45%'>
							<FormItem :label="$t('sideBar.member.title')" prop="crmName"><!--会员-->
								<span  @click="alertcCrm">
									<Input v-model="formValidate.crmName" ></Input>
								</span>
		                    </FormItem>
		                    <FormItem :label="$t('orders.address')" prop="crmaddress"><!--会员地址-->
								<Input v-model="formValidate.crmaddress" ></Input>
		                    </FormItem>
		                    <FormItem :label="$t('orders.mobile')" prop="mobile"><!--手机-->
								<Input v-model="formValidate.mobile" ></Input>
		                    </FormItem>
	                    </div>
	                     <div style='width:45%'>
	                     	<FormItem :label="$t('orders.payType')" prop="modeldztype"><!--付款方式-->
								<Select v-model="formValidate.modeldztype" @on-change="getdztype">
									<Option v-for="item in dztype" :value="item.key" :key="item.key">{{item.title}}</Option>
								</Select>
		                    </FormItem>
		                    <FormItem :label="$t('finance.kyye')" prop="chargeMoney"><!--余额-->
								<Input v-model="formValidate.chargeMoney" disabled></Input>
		                    </FormItem>
		                    <FormItem :label="$t('finance.sk.disc')" prop="discount"><!--折扣-->
								<Input v-model="formValidate.discount" disabled></Input>
		                    </FormItem>
	                     	 
	                    </div>
                    </div>
                    <div style=''>
						<Table size="small" :highlight-row="true" border :columns="cunhuo" :data="cunhuodata" ></Table>	
	                </div>
	                 <div style='width:100%;margin-top:20px'>
						<span>{{this.$t('public.remark')}}：</span><Input v-model="formValidate.remark" type='textarea'></Input>
	                </div>
				</Form>
			</div>
			<!--详情-->
			<div class='right-right' v-if='infoTxt'>
				<el-steps :active="active" finish-status="success" :align-center='true' style='margin-left:30px'> 
				  <el-step :title="this.$t('orders.mjxd')"></el-step>
				  <el-step :title="this.$t('orders.mjfk')"></el-step>
				  <el-step :title="this.$t('orders.sjfk')"></el-step>
				  <el-step :title="this.$t('orders.succ')"></el-step>
				</el-steps>
				<div class='top-info'>
					<div style='margin-right:20px;'>
						<li><span style='font-size:16px;color:#2B8F8F'>{{$t('orders.orderInfo')}}</span></li><!--订单信息-->
						<div style='display:flex'>
						<div>
							<li><span>{{$t('orders.orderNo')}}：</span>{{detailsOrder.orderNo}}</li><!--订单编号-->
							<li><span>{{$t('orders.orderAmount')}}：</span>{{detailsOrder.amount}}</li><!--订单总额-->
							<li><span>{{$t('orders.payType')}}：</span>{{detailsOrder.payTypeDesc}}</li><!--支付方式-->
							<li><span>{{$t('orders.yhq')}}：</span>{{detailsOrder.couponName}}</li><!--优惠券-->
							<li><span>{{$t('orders.disc')}}：</span>{{detailsOrder.discountPrice}}</li><!--折扣金额-->
							<li><span>{{$t('orders.orderTime')}}：</span>{{new Date(detailsOrder.createTime).toLocaleDateString().replace(/\//g,'-')}}</li><!--订单时间-->
							
						</div>
						<div style='margin-left:20px'>
							<li><span>{{$t('orders.pstype')}}：</span>{{detailsOrder.deliveryTypeDesc}}</li><!--配送方式-->
							<li><span>{{$t('orders.kd')}}：</span>{{detailsOrder.expressName}}</li><!--快递公司-->
							<li><span>{{$t('orders.person')}}：</span>{{detailsOrder.receiveName}}</li><!--收货人-->
							<li><span>{{$t('orders.mobile')}}：</span>{{detailsOrder.mobile}}</li><!--手机号-->
							<li><span>{{$t('orders.address')}}：</span>{{detailsOrder.receiveProvince}}{{detailsOrder.receiveCity}}{{detailsOrder.receiveCounty}}{{detailsOrder.receiveAddress}}</li><!--收货地址-->
						</div>
						</div>
					</div>
					<div style=''>
						<li><span style='font-size:16px;color:#2B8F8F'>{{$t('orders.otherInfo')}}</span></li><!--其他信息-->
						
						<li><span>{{$t('orders.DG')}}：</span>{{detailsOrder.employeeName}}</li><!--导购-->
						
						<li><span>{{$t('orders.crm')}}：</span>{{detailsOrder.customerName}}</li><!--会员-->
						<li><span>{{$t('orders.crmcode')}}：</span>{{detailsOrder.crmCode}}</li><!--会员编号-->
						
					</div>
					<div style=''>
						<li><span style='font-size:16px;color:#2B8F8F'>{{$t('orders.orderStatus')}}：</span ><span style='font-size:16px;color:blue'>{{statusDesc}}</span></li><!--订单状态-->
						<li>{{$t('orders.sevenTH')}}</li><!--//如在 7天 内有质量问题，买家可到店进行退货退款-->
					</div>
				</div>	
				<!--详情tab-->
				<div class="detail-title-mark">
					<div v-for="(item,index) in titles" class="detail-title" @click="addborder(index)" :class="{bor:index==num2}">
						{{item}}
					</div>
				</div>
				<div style='margin:20px 0 120px 10px'>
					<!--表格数据-->
					<div class="table" v-if='num2==0'>
						<div style='height:35px;border:1px solid #e4e4e4;line-height:35px;border-bottom:none'>
							<span style='margin-left:10px'>{{$t('orders.orderNo')}}： <a>{{orderno}}</a></span>
						</div>
						<Table border :columns="columns" :data="orderDetail"></Table>
						<div style='text-align:right;height:35px;border:1px solid #e4e4e4;line-height:35px;border-top:none'>
							<span style='margin-right:20px'>{{$t('orders.orderA')}} <a>{{orderDetail.length}}</a> {{$t('orders.orderAjian')}}；{{$t('orders.orderAjianS')}}：<span style='color:red'>￥：{{amount.toFixed(2)}}</span></span>
						</div>
						
					</div>
					<!--财务详情-->
					<!-- <div v-if='num2==1'>
						<Table border :columns="orderFinance" :data="orderFinanceData"></Table>
						
						<div class="page-box">
							 <Page :total="Financetotal" show-total  :pageSize='FinancepageSize'  @on-change="FinancegetData" @on-page-size-change="FinancechangePageSize"></Page>
						</div>
					</div> -->
					<!--订单日志-->
					<!-- <div v-if='num2==2'>
						<Timeline>
					        <TimelineItem v-for='(item,index) in logDate' :key='index'>
					            <span class="TimelineItemtime">{{item.time}}</span>
					            <span class="content">{{item.title}}</span>
					            <span class="content1">{{item.remark}}</span>
					        </TimelineItem>
					    </Timeline>
					</div> -->
					<!--物流历史-->
					<!-- <div v-if='num2==3'>
						<Table border :columns="orderwlH" :data="orderwlHData"></Table>
						
						<div class="page-box">
							 <Page :total="wlHtotal" show-total  :pageSize='wlHpageSize'  @on-change="wlHgetData" @on-page-size-change="wlHchangePageSize"></Page>
						</div>
					</div> -->
				</div>
			</div>
		</div>
		<!--会员弹框-->
		<Modal v-model="ygisshow" width="660px">
			<p slot="header" style="height:30px;line-height:30px">
				
				<span>{{$t('public.search')}}</span>
			</p>
			<div style="position:relative;text-align:center;width:100%;height:35px;line-height:35px;display:flex;">
				<Input v-model="ygkeyword" style="padding:2px 0" @on-enter='enterSearchYg'>
				</Input>
				<span @click="getygKeyword">
				<Icon type="search" size="16" style="display:inline-block;position:absolute;top:10px;right:18px;z-index:9" ></Icon>

				</span>
			</div>
			<div slot="footer" style='margin-top:-10px'>
				
				<Table  border highlight-row height="300" :columns="ygkey" :data="ygdata" @on-row-click="ygrow">
				</Table>
			
	            <div class="page-box" style="text-align:left">
				 <Page :total="ygtotal" :pageSize='ygpageSize' show-total @on-change="getygData" @on-page-size-change="changeygPageSize"></Page>
				</div>
				<div class='title' style='margin:0'>
					<div style='color:#D15151;font-size:14px'>
						<!-- <Icon type="plus" style='margin-right:5px'></Icon>
						<span >添加客户</span> -->
					</div>
					<div>
						<Button shape="circle" type="ghost" style="display:inline-block;background:#ACACAC;border:none;color:#fff" @click='modelCancel'><Icon type="close" style="margin-right:5px;" ></Icon>{{$t('public.cancel')}}</Button>
						<Button shape="circle" type="ghost" style="display:inline-block;background:#00A7F5;color:#fff" @click="makegys"><Icon type="checkmark-round" style=";margin-right:5px;color:#fff"></Icon>{{$t('public.sure')}}</Button>
					</div>
				</div>
			</div>
		</Modal>
		<!--选择商品-->
	<Modal v-model="goodsinshow" width="700px">
		<p slot="header" style="height:30px;line-height:30px">
			
			<span>{{$t('purchase.purchaseOrder.chooseSku')}}</span><!--商品搜索-->
		</p>
		<div style="position:relative;text-align:center;width:100%;height:35px;line-height:35px;display:flex;">
			<Input  :placeholder="$t('public.codeandname')" style="padding:2px 0" v-model="goodskeyword" @on-enter='goodsenter'></Input>
			<span @click="searchInput">
			<Icon type="search" size="16" style="display:inline-block;position:absolute;top:10px;right:18px;z-index:9" ></Icon>
			</span>
		</div>
		<!--商品数据-->
		<div slot="footer">
			<div class="table" style='margin:0px'>
				<Table  border  height='300' highlight-row  :columns="goodskey" :data="goods" @on-row-click="clickgoodsrow">
				</Table>
				<div class="page-box">
				 <Page :total="totalsku" show-total  :pageSize='pageSizesku'  @on-change="getDatasku" @on-page-size-change="changePageSizesku"></Page>
				</div>
           	</div>
			
			<div class='title' style='margin:0px'>
				<div style='color:#D15151;font-size:14px'>
					<!-- <Icon type="plus" style='margin-right:5px'></Icon>
					<span >添加商品</span> -->
				</div>
				<div>
					<Button shape="circle" type="ghost" style="display:inline-block;background:#ACACAC;border:none;color:#fff" @click='modelCancelsku'><Icon type="close" style="margin-right:5px;" ></Icon>{{$t('public.cancel')}}</Button>
					<Button shape="circle" type="ghost" style="display:inline-block;background:#00A7F5;color:#fff" @click="makegoods"><Icon type="checkmark-round" style=";margin-right:5px;color:#fff"></Icon>{{$t('public.sure')}}</Button>
				</div>
			</div>
		</div>
	</Modal>
	<!--商品属性弹框-->
	<Modal v-model="attrModel" width="500px" >
		<p slot="header" style="height:30px;line-height:30px">
			<span>{{$t('purchase.purchaseOrder.attrs')}}</span><!--辅助属性-->
		</p>
			<div class='goodsInfoTop'>
				<span>{{$t('purchase.purchaseOrder.goodsInfo')}}：</span><span>{{goodsrow.barcode}} - {{unitStr}}</span><!--商品信息-->
			</div>
			<Table  border  height='300' highlight-row  :columns="sAttrskey" :data="sAttrsData" @on-row-click="clickAttrRow"></Table>
		<div slot="footer">
			<div >
				<div>
					<Button shape="circle" type="ghost" style="display:inline-block;background:#ACACAC;border:none;color:#fff" @click='modelCancelattr'><Icon type="close" style="margin-right:5px;" ></Icon>{{$t('public.cancel')}}</Button>
					<Button shape="circle" type="ghost" style="display:inline-block;background:#00A7F5;color:#fff;border:none" @click="cgtypeSureattr"><Icon type="checkmark-round" style=";margin-right:5px;color:#fff"></Icon>{{$t('public.sure')}}</Button>
				</div>
			</div>
		</div>
	</Modal>
	<!--物流信息弹框-->
    <Modal v-model="wlisshow" width="420px">
	    <p slot="header" style="height:30px;line-height:30px;text-align:center">
	      <span>{{$t('orders.wl')}}</span><!--物流信息-->
	    </p>
     	<Form ref="logisticssave" :model="logisticsformValidate" :rules="logisticsruleValidate" :label-width="100" >
    	<FormItem :label="$t('orders.pstype')" prop="model2"><!--发运方式：-->
        	<Select v-model="logisticsformValidate.model2" @on-change="getlogistics1" :placeholder="$t('orders.pstype')">
				<Option v-for="(item,index) in logisticstype1" :value="item.value" :key="index" >{{item.label}}</Option>
			</Select>
   		</FormItem>
        <FormItem :label="$t('orders.wlNum')" prop="logisticsNo1"><!--物流单号：-->
           <Input v-model='logisticsformValidate.logisticsNo1' :placeholder="$t('orders.wlNum')"></Input>
        </FormItem>
    	</Form>
	    <div slot="footer">
	      <div class='footer-mark'>
	        <span><a style='color:#999;font-size:14px' @click='cancelSearchpk'>{{$t('public.cancel')}}</a></span>
	        <span style='font-size:20px;width:1px;height:40px;background:#e4e4e4'></span>
	        <span ><a style='color:#3B77E3;font-size:14px' @click="sureSearchpk('logisticssave')">{{$t('public.sure')}}</a></span>
	      </div>
	    </div>
  </Modal>
	<div class='tot'>
        <span>共<span style='color:#ff0000'> {{total}} </span>条</span>
        <span>当前第<span style='color:#ff0000'> {{current}} </span>页</span>
    </div>
	</div>
</template>
<script type="text/javascript">
	export default{
		data(){
			return{
				//详情
				// titles:["订单商品","财务详情","订单日志","物流历史"],,this.$t('orders.FInfo'),this.$t('orders.orderLog'),this.$t('orders.Lhistory')
				titles:[this.$t('orders.infoSku')],
				num2:0,
				//订单日志
				logDate:[
					{
						title:"付款",
						time:"2018-7-5 20:59",
						remark:"XXX"
					},
					{
						title:"付款",
						time:"2018-7-6 20:59",
						remark:"XXX"
					},
					{
						title:"付款",
						time:"2018-7-7 20:59",
						remark:"XXX"
					},
					{
						title:"付款",
						time:"2018-7-8 20:59",
						remark:"XXX"
					},
				],
				//财务详情
				FinancepageSize:0,
				Financetotal:0,
				orderFinance:[],
				orderFinanceData:[],
				//物流历史
				wlHtotal:0,
				wlHpageSize:0,
				orderwlH:[],
				orderwlHData:[],
				//物流登记
				//打包弹框运送方式
				logisticstype1:[
					{
						value: '1',
						label: '顺丰'
					},
					{
						value: '2',
						label: '韵达'
					},
					{
						value: '3',
						label: '圆通'
					}
				],
				wlisshow:false,
				logisticsformValidate:{
					logisticsNo1:'',
					model2:'',
				},
				logisticsruleValidate:{
					logisticsNo1:[{ required: true, message: '请输入物流单号！', trigger: 'blur' },],
					model2:[{ required: true, message: '请选择物流！', trigger: 'change' }]
				},
				active:1,
				issure:false,//确认 线上付款：status==1 && (payTyp==18 || payType==18 && payStatus==9)   
											//status==1 && (payTyp==18 || payType!=18 && payStatus==9)

				iscomit:false,//提交仓库  	status=10 && (payTyp=18 || payType!=18 && payStatus==9)
				isfh:false,//发货中			status=10 && (payTyp=18 || payType!=18 && payStatus==9)
				isyfh:false,//已发货        status=10 && deliveryStatus=0
				isyfk:false,//已付款        payTyp=18 && payStatus==0
				isyqs:false,//已签收        deliveryStatus=2
				isywl:false,//物流
				//商品
				goodsinshow:false,
				goodskeyword:"",
				goodskey:[
					{
	                	title:"",
	                	width:100,
	                	key:"mainPhoto",
	                	 render:(h, params) =>{
	                    	return h('div',[
	                    			h('img',{
	                    				attrs:{
	                    					src:params.row.mainPhoto
	                    				},
	                    				style:{
	                    					width:'40px',
	                    					height:'40px'
	                    				}
	                    			})
	                    		])
	                    }
	                },
	                {
	                    title: this.$t('manage.sku.SkuCode'),//'商品编码',
	                    key:'skuCode',
	                    
	                    width:180,
	                    align: 'center'
	                },
	                 {
	                    title:this.$t('manage.sku.SkuName'),//"商品名称",
	                    ellipsis:true,
	                    width:180,
	                    key:"skuName"
	                },

	                {
	                    title: this.$t('manage.sku.price'),//'吊牌价',
	                    key:'price',
	                    width:120,
	                    align: 'center'
	                },
	                {
	                    title: this.$t('manage.sku.costprice'),//'成本价',
	                    key:'costPrice',
	                    width:120,
	                    align: 'center'
	                },
	                {
	                    title:this.$t('manage.sku.wholeprice'),// '批发价',
	                    key:'wholePrice',
	                    width:120,
	                    
	                    align: 'center'
	                },
	                {
	                    title:this.$t('manage.sku.SkuUnit'),// '单位',
	                    key:'unit',
	                    width:100,
	                    align: 'center'
	                },
	                 {
	                title: this.$t('public.status'),//'状态',
	                key:'statusDesc',
	                width:80,
	                ellipsis:true,
	                render:(h,params)=>{
	                    return h('span',{
	                        style:{
	                            color:params.row.status==1?'#40ca98':'#d53c39'
	                        }
	                    },params.row.statusDesc)
	                }
	                
	            }
				],
				goodsrow:{},
				sAttrsData:[],//规格
				sAttrsUnits:[],//辅助单位
				unitStr:"",
				rowIndex:-1,//属性弹框数量输入框下标
				//弹框属性
				attrIdData:{},//一行规格
				sAttrsData:[],
				details:[],
				totalAmount:0,
				totalCount:0,
				sAttrskey:[
					
					{
						title:this.$t('purchase.purchaseOrder.num'),//数量
						key:"qty",
						width:100,
						align:"center",
						render:(h,parmas)=>{
						return h('Input',{
								props:{
									value:parmas.row.qty
								},
								on:{
									'on-click':(e)=>{
										e.stopPropagation()
									},
									"on-change":(e)=>{
										this.allCouunt=Number(e.target.value)
										parmas.row.qty=this.allCouunt
										this.clickAttrRow(parmas.row,parmas.index)//单击属性一行

									},
									'on-blur':(e)=>{
										this.allCouunt=Number(e.target.value)
										parmas.row.qty=this.allCouunt
										this.sAttrsData[parmas.index].qty=this.allCouunt

									}
								}
							})
						}
					},
					{
						title:this.$t('purchase.purchaseOrder.attrs'),//辅助属性
						key:"skuTypeDesc"
					},
				],
				attrModel:false,
				allCouunt:0,//规格数量
				goods:[],
				//商品页面显示
				cunhuodata:[],
				cunhuo:[
					{
					title:this.$t('public.action'),//操作
					key: 'action',
					width: 100,
					align: 'center',
					render: (h, params) => {
						return h('div', [
							h('div', {
								style: {
									float: 'left',
									marginRight: '5px'
								},
								on: {
									click: (e) => {
											//点击加号
											e.stopPropagation()
											// this.cunhuodata.push({})
										}
									}
								}, [
								h('img', {
									domProps: {
										src: 'http://img.zsydian.com/icon/add.png',
										style: "width:20px;height:20px;cursor:pointer"
									},
									on:{
										'click':()=>{
											//单击添加
											this.clickgoodsAdd()
										}
									}
								})
								]),
							h('div', {
								style: {
									float: 'left',
									marginRight: '5px'

								},
								on: {
									click: () => {
											// this.delGoods(params.row.id);
										}
									}
								}, [
								h('img', {
									domProps: {
										src: 'http://img.zsydian.com/icon/tabledel.png',
										style: "width:20px;height:20px;cursor:pointer"
									},
									on:{
										click:(e)=>{
											e.stopPropagation()
												//删除行
												
												if(params.index==0){
													return
												}
												this.remove(params.index)
												
											}
										}

									})
								])
							]);
					}
					},
					{
						title:this.$t('manage.sku.SkuCode'),//货号
						
						width:140,
						key:"skucode"
					},
					{
						title:this.$t('manage.sku.SkuName'),//商品名称
						width:160,
						key:"skuName",
						ellipsis:true,
						align: 'left'
					},
					{
						title:this.$t('purchase.purchaseOrder.num'),//数量
						width:70,
						key:"qty",
						render:(h,parmas)=>{
							return h('Input',{
									style:{
										
										width:"67px",
										height:"40px",
										marginLeft:"-17px",
										lineHeight:'40px',
										border:'none'
										
									},
									props:{

										value:parmas.row.qty
										
									},
									
									on:{
										'on-click':(e)=>{
											// this.nindex=parmas.index
											e.stopPropagation()
										},
										"on-change":(e)=>{
												this.allCouunt = Number(e.target.value)
												parmas.row.qty= parseInt(e.target.value)
												parmas.row.amount=Number(parmas.row.price)*parseInt(this.allCouunt) 
												parmas.row.amount.toFixed(2)
										},
										'on-blur':()=>{
												let resultqty=0
												let resultPrice=0
												this.cunhuodata[parmas.index].qty=parseInt(this.allCouunt)
												this.cunhuodata[parmas.index].amount=this.cunhuodata[parmas.index].price*this.allCouunt 
												for(let i=0;i<this.details.length;i++){
													resultqty+=parseInt(this.details[i].qty)
													resultPrice+=parseInt(this.details[i].amount)
												}
												this.totalCount=parseInt(resultqty)//总数量
												this.totalAmount=resultPrice//总价值
												this.totalAmount.toFixed(2)//总价值
												this.totalAmount.toFixed(2)

											}
										}
									})
						}
					},

					
					{
						title:this.$t('manage.sku.price'),//价格
						width:120,
						key:"price",
						render:(h,parmas)=>{
							return h('Input',{
								props:{
									value:parmas.row.price
								},
								on:{
									'on-click':(e)=>{
										e.stopPropagation()
									},
									"on-change":(e)=>{
										
										parmas.row.price=Number(e.target.value)
										
									},
									'on-blur':(e)=>{
										parmas.row.price=Number(e.target.value)
										this.cunhuodata[parmas.index].price=Number(e.target.value)
										this.cunhuodata[parmas.index].amount=Number(parmas.row.price)*Number(parmas.row.qty)
										

									}
								}
							})
						}
					},
					
					{
						title:this.$t('manage.sku.SkuUnit'),//单位
						width:70,
						
						key:"unit"
					},
					{
						title:this.$t('manage.sku.inventoryUp'),//库存
						width:100,
						
						key:"inventoryUp"
					},
					{
						title:this.$t('purchase.purchaseOrder.Allamount'),//总价
						key:'amount',
						width:100,
						render:(h,parmas)=>{
							return h('span',{
								style:{
									color:'red'
								}
							},Number(parmas.row.amount).toFixed(2))
						}
					},
					{
						title:this.$t('purchase.purchaseOrder.attrs'),//辅助属性
						width:180,
						key:"skuTypeDesc"
					}
				],
				cunhuodata:[{skuName:this.$t('operation.yhqHome.choosesku'),amount:0}],//'选择商品'
				totalsku:0,
				pageSizesku:0,
				//会员
				ygisshow:false,
				ygkeyword:"",
				crmObj:{},//会员一行数据
				ygkey:[
					{
						title:this.$t('member.code'),//"编码",
						key:"code",
					},
					{
						title:this.$t('member.name'),//"姓名",
						key:"name",
					},
					{
						title:this.$t('member.ye'),//"余额",
						key:"chargeMoney",
					},
					{
						title:this.$t('member.address'),//"地址",
						key:"address",
					},
				],
				ygdata:[],
				ygtotal:0,
				ygpageSize:0,
				//新增数据
				//支付类型列表 1：聚合支付 5：余额支付 9：现金支付 11：刷卡支付 15：DOCU支付 18：线下付款 25 其他支付
				dztype:[
					{
						title:this.$t('orders.jheP'),//"聚合支付",
						key:"1"
					},
					{
						title:this.$t('orders.yeP'),//"余额支付",
						key:"5"
					},
					{
						title:this.$t('orders.xjP'),//"现金支付",
						key:"9"
					},
					{
						title:this.$t('orders.xkP'),//"刷卡支付",
						key:"11"
					},
					{
						title:this.$t('orders.DOKU'),//"DOCU支付",
						key:"15"
					},
					{
						title:this.$t('orders.xxP'),//"线下付款",
						key:"18"
					},
					{
						title:this.$t('orders.qtP'),//"其他支付",
						key:"25"
					},

				],
				
				formValidate:{
					crmName:"",//会员名称
					crmid:"",//会员名称
					crmaddress:"",//会员地址
					modeldztype:"",//支付方式
					crmCode:"",
					remark:"",
					mobile:"",
					chargeMoney:"0",//可用余额
					discount:"",//折扣
				},
				ruleValidate:{
					crmName:[
                         { required: true, message:this.$t('orders.crmNoEmpty'),pattern: /.+/, trigger: 'change'}
                    ],
                    mobile:[ { required: true, message:this.$t('orders.phoneNoEmpty'), trigger: 'blur'}],
                    crmaddress:[ { required: true, message:this.$t('orders.addressNoEmpty'), trigger: 'blur'}],
                    modeldztype:[ { required: true, message:this.$t('orders.payNoEmpty'), trigger: 'blur'}],
				},
				addTxt:true,//新增
				editTxt:false,//修改
				infoTxt:false,//详情
				tk1:true,
				surebtn1:true,
				tkText:'确认退款',
				
				tk:false,
				cancel:false,
				active:1,
				orderno:'',
				
				current:1,
				height:'',
				numIndex:0,
				indexId:'',
				num2:0,
				orderdataList:[],
				 pageSize:0,
				 total:0,
				columns:[
					{
                        title: '',
                        key:'mainPhoto',
                        width:80,
                        align: 'center',
                        render:(h, params) =>{
                        	return h('div',[
                        			h('img',{
                        				attrs:{
                        					src:params.row.mainPhoto
                        				},
                        				style:{
                        					width:'40px',
                        					height:'40px',
                        					marginTop:'4px'
                        				}
                        			})
                        		])
                        }
                    },
                    {
						title:this.$t('manage.sku.barcode'),//"条码",
						key:'barcode'
					},
					{
						title:this.$t('orders.sku'),//"商品",
						ellipsis:true,
						key:'skuName'
					},
					{
						title:this.$t('public.num'),//"数量",
						align:"center",
						 width: 100,
						key:'qty'
					},
					{
						title:this.$t('orders.price'),//"价格",
						align:"center",
						 width: 100,
						key:'price'
					},
					{
						title:this.$t('orders.disc'),//"优惠",
						align:"center",
						 width: 100,
						key:'discount'
					},
					{
						title:this.$t('orders.attrs'),//"属性",
						
						key:"skuTypeDesc"
					},
					{
						title:this.$t('public.status'),//"状态",
						align:"center",
						width:100,
						key:'goodStatus'
					},
				],
				uid: this.$store.state.common.token,
				value:0,
				orderTypeList:[
					{
						label:this.$t('public.all'),//"全部",
						value:0
					},
					{
						label:this.$t('orders.orderDfk'),//"待支付",
						value:10
					},
					{
						label:this.$t('orders.orderDfh'),//"待发货",
						value:33
					},
					{
						label:this.$t('orders.orderYFH'),//"已发货",
						value:40
					},
					{
						label:this.$t('public.success'),//"已完成",
						value:50
					},
					{
						label:this.$t('public.close'),//"已关闭",
						value:99
					},
					{
						label:this.$t('orders.orderTKZ'),//"退款中",
						value:77
					},
				],
				total:0,
				pageSize:0,
				AllOrderList:[],
				orderDetail:[],
				statusDesc:'',
				type:'',
				createTime:'',
				total:0,
				pageSize:0,
				amount:0,
				receiveAddress:'',//收货地址
				receiveCity:'',//收货地址
				deliveryTypeDesc:'',//配送方式
				mobile :'',//手机号
				trueName :'',//买家名
				payTypeDesc :'',//支付方式
				tkModel:false,
				detailsOrder:{}//订单详情
			}
		},
		methods:{
			//点击新增
			add(){
				this.orderno=this.$t('orders.addorder'),//'新增'
				this.addTxt=true//新增
				this.editTxt=false//修改
				this.infoTxt=false//详情
				this.issure=false//确认
				this.iscomit=false//提交仓库
				this.isfh=false//发货中
				this.isyfh=false//已发货
				this.isyfk=false//已付款
				this.isyqs=false//已签收
			},
			
			
			//会员弹框
			alertcCrm(){
				this.ygisshow=true
				//GET /crm/query 会员清单
				this.axios.get('/crm/query?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.ygdata=res.data.rows
						this.ygtotal=res.data.total
						this.ygpageSize=res.data.pageSize
						
					}
				})
			},
			//单击会员一行
			ygrow(data){
				this.crmObj=data
				console.log(data)
			},
			//会员确认
			makegys(){
				this.formValidate.crmName=this.crmObj.name;
				this.formValidate.crmid=this.crmObj.id;
				this.formValidate.crmCode=this.crmObj.code;
				this.formValidate.crmaddress=this.crmObj.address;
				this.formValidate.mobile=this.crmObj.mobile;
				this.formValidate.chargeMoney=this.crmObj.chargeMoney//余额
				this.formValidate.discount=this.crmObj.discount//折扣

				this.ygisshow=false

			},
			//搜索会员
			getygKeyword(){
				this.axios.get('/crm/query?keyword='+this.ygkeyword+'&uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.ygdata=res.data.rows
						this.ygtotal=res.data.total
						this.ygpageSize=res.data.pageSize
					}
				})
			},
			//回车确认
			enterSearchYg(){
				this.getygKeyword()
			},
			//翻页
			getygData(current){
				this.axios.get('/crm/query?offset='+current+'&uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.ygdata=res.data.rows
						this.ygtotal=res.data.total
						this.ygpageSize=res.data.pageSize

					}
				})
			},
			changeygPageSize(size){
				this.ygpageSize=size
			},
			//会员取消
			modelCancel(){
				this.ygisshow=false
			},
			//点击加号加商品
			clickgoodsAdd(){
				if(this.formValidate.crmid==''){
					this.$notify({
				        title:"",//
				        message:this.$t('orders.selecCrm'),
				        type: 'error',
				        position: 'bottom-right'
			        });
				}else{
					this.goodsinshow=true
					//GET /sku/query 商品清单GET /inventory/query 全部库存
						this.axios.get('/sku/query?uid='+this.uid).then(res=>{
						if(res.data.status==200){
							this.goods=res.data.rows
							this.totalsku=res.data.total
							this.pageSizesku=res.data.pageSize
						}
					})
				}
			},
			//删除一行已选定的商品数据
			remove (index) {
				this.cunhuodata.splice(index, 1);
				this.details.splice(index-1, 1);
				console.log(this.details)
			},
			//搜索商品
			searchInput(){
				this.axios.get('/sku/query?keyword='+this.goodskeyword+'&uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.goods=res.data.rows
						this.totalsku=res.data.total
						this.pageSizesku=res.data.pageSize
					}
				})
			},
			//商品搜索回车
			goodsenter(){
				this.searchInput()
			},
			//单击商品一行
			clickgoodsrow(data){
				this.goodsrow = data//选中商品一行的/inventory/viewsku/数据GET  /sku/get
				this.axios.get('/sku/get/'+data.id+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){

						if(res.data.rows.attrDetailList!=null && res.data.rows.specs.length!=0){
							this.attrModel=true
							this.sAttrsData=res.data.rows.attrDetailList//属性
							this.sAttrsUnits=res.data.rows.unitList//辅助单位
							this.sAttrsData.forEach(x=>{
								x.qty=Number(this.allCouunt)
							})
							//字符床拼接辅助属性
							let sName=[]
							this.sAttrsUnits.forEach((j,i)=>{
								sName.push(this.sAttrsUnits[i].unitName)
							})
							this.unitStr=sName.join(',')
							
						}
						
					}
				})
			},
			//点击规格一行
			clickAttrRow(data,index){
				this.rowIndex=index
				this.attrIdData=data
			},
			//添加属性确认按钮
             cgtypeSureattr(){
             	console.log(this.attrIdData)
             	let arr = Object.keys(this.attrIdData)//确认前检查是否选择了属性
             	if(arr.length==0){
             		this.attrModel=false
             	}else{
             		let goodsarr={
						skuName:this.goodsrow.skuName,
						skuId:this.goodsrow.id,
						inventoryUp:this.goodsrow.inventoryUp,
						inventory:this.goodsrow.inventory,
						// inventoryId:this.goodsrow.id,
						qty:Number(this.allCouunt),
						price:this.goodsrow.price,
						costPrice:this.goodsrow.costPrice,
						skucode:this.goodsrow.skuCode,
						unit:this.goodsrow.unit,
						unitId:this.goodsrow.unitId,
						barcode:this.goodsrow.barcode,
						wholePrice:this.goodsrow.wholePrice,
						skuTypeId:this.attrIdData.id,//属性编号
						skuTypeDesc:this.attrIdData.skuTypeDesc,//属性描述
						receiptQty:Number(this.allCouunt),
						mainPhoto:this.goodsrow.mainPhoto,
						crmId:this.formValidate.crmid,
						// storeId:this.goodsrow.warehouseId,
					}
					//添加一个总价格
					goodsarr['amount']=Number(parseInt(goodsarr.qty))*Number(goodsarr.price)
					goodsarr['amount'].toFixed(2)
					//页面显示的表格
					this.cunhuodata.push(goodsarr)
					//传给后台的表格数据
					this.details.push(goodsarr)
					console.log(this.details)
						//计算初始总价
					this.totalAmount+=goodsarr['amount']
					//计算初始数量
					this.totalCount+=Number(this.allCouunt)
					// this.attrModel=false
					this.allCouunt=0
					this.attrsArr=[]
					this.attrIdData={}
					this.attrModel=false
					// this.rowIndex=-1
             	}
             	
            },
            //选择商品确认
			makegoods(){
				if(this.sAttrsData.length==0){
					let goodsarr={
						skuName:this.goodsrow.skuName,
						skuId:this.goodsrow.id,
						inventoryUp:this.goodsrow.inventoryUp,
						inventory:this.goodsrow.inventory,
						// inventoryId:this.goodsrow.id,
						qty:Number(this.allCouunt),
						price:this.goodsrow.price,
						costPrice:this.goodsrow.costPrice,
						skucode:this.goodsrow.skuCode,
						unit:this.goodsrow.unit,
						unitId:this.goodsrow.unitId,
						wholePrice:this.goodsrow.wholePrice,

						skuTypeId:this.attrIdData.id,//属性编号
						skuTypeDesc:this.attrIdData.skuTypeDesc,//属性描述
						receiptQty:Number(this.allCouunt),
						mainPhoto:this.goodsrow.mainPhoto,
						crmId:this.formValidate.crmid,
					}
					goodsarr['amount']=Number(parseInt(goodsarr.qty))*Number(goodsarr.price)
					goodsarr['amount']=goodsarr['amount']
					goodsarr['amount'].toFixed(2)

					this.cunhuodata.push(goodsarr)
					
					this.details.push(goodsarr)

					//计算初始总价
					this.totalAmount+=goodsarr['amount']
					//计算初始数量
					this.totalCount+=Number(this.allCouunt)
					
				}
				this.goodsinshow = false
				this.allCouunt=0
				this.attrsArr=[]
				this.sAttrsData=[]
				this.attrIdData={}
			},
			//属性取消
            modelCancelattr(){
            	this.attrModel=false
            },
			//商品翻页
			getDatasku(current){
				this.axios.get('/sku/query?offset='+current+'&uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.goods=res.data.rows
						this.totalsku=res.data.total
						this.pageSizesku=res.data.pageSize
					}
				})
			},
			//
			changePageSizesku(size){
				this.pageSizesku=size
			},
			//选择商品取消
			modelCancelsku(){
				this.goodsinshow=false
			},
			//保存POST /order/add 添加订单
			save(name){
				this.$refs[name].validate((valid) => {
					if(valid){
						if(this.details.length==0){
							this.$notify({
						        title:"",//
						        message: '请选择商品',
						        type: 'error',
						        position: 'bottom-right'
					        });
						}else{
							this.axios.post('/morder/gd?uid='+this.uid,{
								amount:this.totalAmount,
								orderType:3,//线上订单
								payType:Number(this.formValidate.modeldztype),
								crmCode:this.formValidate.crmCode,
								crmId:this.formValidate.crmid,
								customerName:this.formValidate.crmName,
								details:this.details,
								receiveAddress:this.formValidate.crmaddress,
								mobile:this.formValidate.mobile,
								chargeMoney:this.formValidate.chargeMoney,
								discount:this.formValidate.discount
							}).then(res=>{
								if(res.data.status==200){
									this.$notify({
								        title:"",//
								        message: this.$t('public.SaveSuccess'),//
								        type: 'success',
								        position: 'bottom-right'
							        });
							        this.getAllOrder()//获取所有线上订单
									this.details=[]
									this.cunhuodata=[{skuName:this.$t('operation.yhqHome.choosesku'),amount:0}],//'选择商品'
									this.crmObj={}
									this.formValidate.crmid=''
									this.formValidate.crmName=''
									this.formValidate.crmCode=''
									this.formValidate.mobile=''
									this.formValidate.address=''
									this.formValidate.chargeMoney=0
									this.formValidate.discount=''
									this.allCouunt=0
									this.totalAmount=0
									this.chargeMoney=0

									this.formValidate.crmaddress=''
									this.formValidate.remark=''
								}else{
									this.$notify({
								        title:"",//
								        message: res.data.errorMessage,
								        type: 'success',
								        position: 'bottom-right'
							        });
								}
							})
						}
						
						
					}
				})
			},
			//单击左侧列表
			getcginfo(id,index){
				this.numIndex = index
				this.indexId = id
				this.addTxt=false//新增
				this.editTxt=false//修改
				this.infoTxt=true//详情
				
				this.getCrmDetail(id)
			},
			//确定GET /order/confrim/{id} 确认
			orderSure(){
				if(this.indexId==''){
					this.$notify({
					        title:"",//
					        message:this.$t('orders.selecOrder'),
					        type: 'success',
					        position: 'bottom-right'
				        });
				}else{
					this.axios.get('/morder/confrim/'+this.indexId+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.$notify({
					        title:"",//
					        message: '确认成功',
					        type: 'success',
					        position: 'bottom-right'
				        });
				        this.getAllOrder()//获取所有线上订单
					}else{
						this.$notify({
					        title:"",//
					        message: res.data.errorMessage,
					        type: 'success',
					        position: 'bottom-right'
				        });
					}
				})
				}
				
			},
			//GET /order/placed/{id} 提交仓库
			orderComit(){
				if(this.indexId==''){
					this.$notify({
					        title:"",//
					        message:this.$t('orders.selecOrder'),
					        type: 'success',
					        position: 'bottom-right'
				        });
				}else{
					this.axios.get('/morder/placed/'+this.indexId+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.$notify({
					        title:"",//
					        message: '提交仓库成功',
					        type: 'success',
					        position: 'bottom-right'
				        });
				        this.wlisshow=true//物流按钮显示
				        this.getAllOrder()//获取所有线上订单
					}else{
						this.$notify({
					        title:"",//
					        message: res.data.errorMessage,
					        type: 'success',
					        position: 'bottom-right'
				        });
					}
				})
				}
				
			},
			//GET /order/confrimvendor/{id} 发货中
			orderfh(){
				if(this.indexId==''){
					this.$notify({
					        title:"",//
					        message:this.$t('orders.selecOrder'),
					        type: 'success',
					        position: 'bottom-right'
				        });
				}else{
					this.axios.get('morder/confrimvendor/'+this.indexId+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.$notify({
					        title:"",//
					        message: '发货中',
					        type: 'success',
					        position: 'bottom-right'
				        });
				        this.getAllOrder()//获取所有线上订单
					}else{
						this.$notify({
					        title:"",//
					        message: res.data.errorMessage,
					        type: 'success',
					        position: 'bottom-right'
				        });
					}
				})
				}
				
			},
			//GET /order/dispatch/{id} 已发货
			orderYfh(){
				if(this.indexId==''){
					this.$notify({
					        title:"",//
					        message:this.$t('orders.selecOrder'),
					        type: 'success',
					        position: 'bottom-right'
				        });
				}else{
					this.axios.get('/morder/dispatch/'+this.indexId+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.$notify({
					        title:"",//
					        message: '已发货',
					        type: 'success',
					        position: 'bottom-right'
				        });
				        this.getAllOrder()//获取所有线上订单
					}else{
						this.$notify({
					        title:"",//
					        message: res.data.errorMessage,
					        type: 'success',
					        position: 'bottom-right'
				        });
					}
				})
				}
				
			},
			//GET /order/delivered/{id} 已签收
			orderYqs(){
				if(this.indexId==''){
					this.$notify({
					        title:"",//
					        message:this.$t('orders.selecOrder'),
					        type: 'success',
					        position: 'bottom-right'
				        });
				}else{
					this.axios.get('/morder/delivered/'+this.indexId+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.$notify({
					        title:"",//
					        message: '已签收',
					        type: 'success',
					        position: 'bottom-right'
				        });
				        this.getAllOrder()//获取所有线上订单
					}else{
						this.$notify({
					        title:"",//
					        message: res.data.errorMessage,
					        type: 'success',
					        position: 'bottom-right'
				        });
					}
				})
				}
				
			},
			//GET /order/paid/{id} 付款
			orderYfk(){
				if(this.indexId==''){
					this.$notify({
					        title:"",//
					        message:this.$t('orders.selecOrder'),
					        type: 'success',
					        position: 'bottom-right'
				        });
				}else{
					this.axios.get('/morder/paid/'+this.indexId+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						this.$notify({
					        title:"",//
					        message: '已付款',
					        type: 'success',
					        position: 'bottom-right'
				        });
				        this.getAllOrder()//获取所有线上订单
					}else{
						this.$notify({
					        title:"",//
					        message: res.data.errorMessage,
					        type: 'success',
					        position: 'bottom-right'
				        });
					}
				})
				}
				
			},
			//物流登记
			orderWl(){
				this.wlisshow=true
			},
			cancelSearchpk(){
				this.wlisshow=false
			},
			//确认
			sureSearchpk(name){
				this.$refs[name].validate((valid) => {

				})
			},
			//选择物流
			getlogistics1(value){
				this.logisticsformValidate.model2 = value
			},
			//获取订单详情
			getCrmDetail(id){
				this.axios.get('morder/get/'+id+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						console.log(res.data.rows)
						this.orderDetail=res.data.rows.details
						this.detailsOrder=res.data.rows
						let rows=res.data.rows
						this.orderno=res.data.rows.orderNo
						this.deliveryTypeDesc=res.data.rows.deliveryTypeDesc//配送方式
						this.mobile=res.data.rows.mobile//手机号
						this.trueName=res.data.rows.trueName//买家名
						this.receiveAddress=res.data.rows.receiveAddress//地址
						this.receiveCity =res.data.rows.receiveCity //地址
						this.payTypeDesc =res.data.rows.payTypeDesc //支付方式
						this.statusDesc=res.data.rows.statusDesc
						
						this.mobile=res.data.rows.mobile
						// issure:false,//确认
						// iscomit:false,//提交仓库
						// isfh:false,//发货中
						// isyfh:false,//已发货
						// isyfk:false,//已付款
						// isyqs:false,//已签收
						//线下付款
						//确认
						if(rows.status==1 && (rows.payTyp==18 || rows.payType==18 && rows.payStatus==9)){
							this.issure=true//确认
							this.iscomit=false//提交仓库
							this.isfh=false//发货中
							this.isyfh=false//已发货
							this.isyfk=false//已付款
							this.isyqs=false//已签收
							this.active=1
						}
						//确认
						if(rows.status==1 && (rows.payTyp==18 || rows.payType!=18 && rows.payStatus==9)){
							this.issure=true//确认
							this.iscomit=false//提交仓库
							this.isfh=false//发货中
							this.isyfh=false//已发货
							this.isyfk=false//已付款
							this.isyqs=false//已签收
							this.active=1
						}
						////提交仓库
						if(rows.status==10 && (rows.payTyp==18 || rows.payType!=18 && rows.payStatus==9)){
							this.issure=false//确认
							this.iscomit=true//提交仓库
							this.isfh=false//发货中
							this.isyfh=false//已发货
							this.isyfk=false//已付款
							this.isyqs=false//已签收
							this.active=2
						}
						//发货中status=10 && (payTyp=18 || payType!=18 && payStatus==9)
						if(rows.status==10 && (rows.payTyp==18 || rows.payType!=18 && rows.payStatus==9)){
							this.issure=false//确认
							this.iscomit=false//提交仓库
							this.isfh=true//发货中
							this.isyfh=false//已发货
							this.isyfk=false//已付款
							this.isyqs=false//已签收
							this.active=2
						}
						//已发货status=10 && deliveryStatus=0
						if(rows.status==10 && rows.deliveryStatus==0){
							this.issure=false//确认
							this.iscomit=false//提交仓库
							this.isfh=false//发货中
							this.isyfh=true//已发货
							this.isyfk=false//已付款
							this.isyqs=false//已签收
							this.active=3
						}
						//已付款payTyp=18 && payStatus==0
						if(rows.payTyp==18 && rows.payStatus==0){
							this.issure=false//确认
							this.iscomit=false//提交仓库
							this.isfh=false//发货中
							this.isyfh=false//已发货
							this.isyfk=true//已付款
							this.isyqs=false//已签收
							this.active=2
						}
						// 已签收deliveryStatus=2
						if(rows.deliveryStatus==2){
							this.issure=false//确认
							this.iscomit=false//提交仓库
							this.isfh=false//发货中
							this.isyfh=false//已发货
							this.isyfk=false//已付款
							this.isyqs=true//已签收
							this.active=2
						}
						switch(rows.status){
							case 10: //待支付
								this.active=1
							break;
							case 20://已付款
								this.active=2
							break;
							case 30://送货中
								this.active=3
							break;
							case 35://已发货
								this.active=3
							break;
							case 40://待自提
								this.active=3
							break;
							case 50: //已完成 //已取消
								this.active=4
							break;
							case 99: //已取消
								this.active=4
							break;
						}
						
						//0 新增 1;//可售后 3;//售后中 6;//已售后 9;//完成
						this.orderDetail.forEach(x=>{
							switch(x.goodStatus){
								case 0:
									x.goodStatus='新增'
								break;
								case 1:
									x.goodStatus='可售后'
								break;
								case 3:
									x.goodStatus='售后中'
								break;
								case 6:
									x.goodStatus='已售后'
								break;
								case 9:
									x.goodStatus='完成'
								break;
							}
						})
						this.createTime=res.data.rows.createTime
						
						this.amount=res.data.rows.amount
						
						this.createTime=new Date(this.createTime).toLocaleDateString().replace(/\//g,'-')
					}
				})
			},
			//获取所有线上订单
			getAllOrder(){
				this.axios.get('morder/listgd?uid='+this.uid).then(res=>{
					// console.log(res)
					if(res.data.status==200){
						this.AllOrderList=res.data.rows
						this.total=res.data.total
						this.pageSize=res.data.pageSize
						this.AllOrderList.forEach((item,index)=>{
							item.createTime=new Date(item.createTime).toLocaleDateString().replace(/\//g,'-')
						})
					}
				})
			},

			 //下拉框选择
			orderselected(value){
				this.value = value
			},
			//下拉加载更多
            handleReachEdge(){
				this.current++//默认10条
				this.axios.get('morder/listgd?offset='+this.current+'&uid='+this.uid).then((res)=>{
	 				if(this.current>Math.ceil(this.total/this.pageSize)){
	 						this.current=Math.ceil(this.total/this.pageSize)
	 					}
			 		res.data.rows.forEach((item)=>{
			 			this.AllOrderList.push(item)

			 			this.AllOrderList.forEach((x,index)=>{
							x.createTime=new Date(x.createTime).toLocaleDateString().replace(/\//g,'-')
						})
			 		})

			 	}) 
    	 		    
            },
            //叉号返回
        	cancelHome(){
        		this.$router.push('/storeorder')
        	},
        	//选择支付类型
            getdztype(value){
            	this.formValidate.modeldztype = value
            	
            },
			//物流取消
          	cancelwl(){
          		this.tkModel=false
          	},
          	//详情
          	//添加下边框 tab页getFinance()
			addborder(index){
				this.num2 = index
				switch(this.num2){
					case 0://订单商品

					break;
					case 1://财务
						this.getFinance()
					break;
					case 2://订单日志
						this.getLog()
					break;
					case 3://物流历史
						this.getwlHistory()
					break;
				}

			},
			//获取财务详情this.indexId
			getFinance(){
				// this.axios.get('').then(res=>{
				// 	if(res.data.status==200){
				// 		this.orderFinanceData=res.data.rows
				// 		this.FinancepageSize=res.data.total
				// 		this.Financetotal=res.data.pageSize
				// 	}
				// })
			},
			//财务详情翻页
			FinancegetData(current){
				// this.axios.get('').then(res=>{
				// 	if(res.data.status==200){
				// 		this.orderFinanceData=res.data.rows
				// 		this.FinancepageSize=res.data.total
				// 		this.Financetotal=res.data.pageSize
				// 	}
				// })
			},
			FinancechangePageSize(size){
				this.FinancepageSize=size
			},
			//订单日志
			getLog(){
				// this.axios.get('').then(res=>{
				// 	if(res.data.status==200){
				// 		this.logDate=res.data.rows
						
				// 	}
				// })
			},
			//获取物流历史this.indexId
			getwlHistory(){
				// this.axios.get('').then(res=>{
				// 	if(res.data.status==200){
				// 		this.orderwlHData=res.data.rows
				// 		this.wlHpageSize=res.data.total
				// 		this.wlHtotal=res.data.pageSize
				// 	}
				// })
			},
			//翻页
			wlHgetData(current){
				// this.axios.get('').then(res=>{
				// 	if(res.data.status==200){
				// 		this.orderwlHData=res.data.rows
				// 		this.wlHpageSize=res.data.total
				// 		this.wlHtotal=res.data.pageSize
				// 	}
				// })
			},
			wlHchangePageSize(size){
				this.wlHpageSize=size
			},
			
			
		},
		mounted(){
			if(this.$route.query.id){
				this.indexId = this.$route.query.id
				this.numIndex = this.$route.query.index
				// this.statusDesc=this.$route.query.s
				this.value=this.$route.query.s
				this.getAllOrder()//获取所有线上订单
				this.getcginfo(this.indexId,this.numIndex)
				this.getCrmDetail(this.indexId)
				
			}else{
				this.getAllOrder()//获取所有线上订单

			}
			
			this.height = document.documentElement.clientHeight
			window.onresize=function(){
				this.height = document.documentElement.clientHeight
			}
		}
	}
</script>
<style type="text/css" scoped>
.head{
	height:60px;
	background: #fff;
	
}
.tot{
    position:fixed;
    bottom:10px;
    left:15%;
    z-index:12;
}
.left-top{
	height: 60px;
	width:360px;
	flex:0 0 360px;
	line-height: 60px;
	position:fixed;
	z-index:12;
	display:flex;
	background: #fff;
	padding-right:10px;
	border-bottom:1px solid #eee;
	border-right:1px solid #eee;
	justify-content: space-between;
}
.right-top{
	height: 60px;
	border-bottom:1px solid #eee;
	line-height: 60px;
	position:fixed;
	z-index:10;
	display:flex;
	width:65%;
	width:100%;
	background: #fff;
	justify-content: space-between;

}
.lanrenLeft{
	position: absolute;
    text-align: center;
    top: 0px;
    right: 0px;
    width: 0;
    height: 0;
    border-top:40px solid #d53c39;
    border-left:40px solid transparent;
}
.lanrenLeft span{
width: 40px;
    height: 23px;
    color: #fff;
    display: block;
    position: relative;
    z-index: 9999999999999;
    top: -36px;
    right: 36px;
    font-size: 12px;
     font-weight: 100; 
    transform: rotate(46deg);
}
.bgd3{
    border-top:40px solid #40ca98;
}
.bgd4{
    border-top:40px solid #278fa3;
}
/*状态的颜色 新增*/
.bgd5{
    border-top:40px solid #284a8a;
}
/*状态的颜色 */
.bgd6{
    border-top:40px solid #40ca98;
}
.bgd7{
    border-top:40px solid #629b86;
}
.bgd8{
    border-top:40px solid #298E8E;
}
.bgd9{
    border-top:40px solid #3b77e3;
}
.tkmodel{
	width:100%;
	
	display: flex;
	
	text-align: center;
	direction: flex;
	justify-content: center;
	flex-direction: column;
	align-items: center;
}
.page-box{
	text-align: left;
}
.table{
	margin-top:20px;

}
li{
	list-style: none
}
.info-left li{
	padding:5px 0;
}
.colorGender1{
	color:#72B7EA;
}
.colorGender0{
	color:#FF934D;
}
.wldw{
	margin-left:10px;
}
.top-info{
	display:flex;
	border-bottom:1px solid #e4e4e4;
	padding:10px 20px;
	
}
.top-info li{
	list-style: none;
	margin-top:10px;
}
.top-left-btn{
background: #3B77E3;
margin-right: 10px;
color: #fff;
border: none;
width: 26px;
height: 26px;
border-radius: 26px;
display: inline-block;
position: relative;
top: 12px;
}
.top-left-btn1{
background: #FF7D16;
}
.top-left-btn:hover{
cursor:pointer;
}
.left-content {
	height:100%;
	width:360px;
	flex:0 0 360px;
	margin-bottom:300px;
	border-right:1px solid #E6E6E6;
	position:fixed;
	background:#F9F9F9;
}
.con-list {
	display:flex;
	align-items: center;
	width: 100%;
	word-wrap:break-word;
	
	border-bottom: solid 1px #E6E6E6;
	padding: 15px 25px;
	
	cursor: pointer;
	position:relative;
}
.con-list:hover{
	cursor:pointer;
}
.con-list .date{
	position:absolute;
	right:10px;
	top:10px;
}
.con-list .status{
	width:100px;
	
	text-align: center;
	position: absolute;
    right: 0px;
    top: 47px;
}
.con-list .list-title {
	color: #0d0d0d;
	font-size: 14px;
	margin-bottom: 10px;
}
.con-list .date1{
position: absolute;
    right: 10px;
    top: 50px;
    }
.con-list .txt {
    color: #585858;
    font-size: 12px;
    width: 180px;
    position: absolute;
    top: 40px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.but{
	background:#3b77e3;margin-right:5px;color:#fff;border:none
}
.bg{
	background:#dbe5f1;
color:#000;
}
.add-right {
	
	background: #fff;
	height:100%;
	
	margin-left:360px;
	padding-right:20px;
	padding-top:10px;
	display:flex;
}
div.con-list:last-child{
	margin-bottom:180px;
}
.list-box{
	display: flex;
	height:35px;
	line-height: 35px;
	margin:25px 10px;
}
.list-box1{
		margin:4px 10px;
}
.list-box span{
	height:40px;
	width:120px;
	text-align: center;
	padding:0 10px;
	font-weight:600;
}
.list-box input.ivu-input{
	height:40px!important;
}
.list-box1{
	margin-left:20px;
}
.list-box1 span{
	width:auto;
	text-align: left
}
.right-left{
	width: 230px;
    margin-top: 26px;
	
}
.right-right{
	width:100%;
}
.step{
	width:100%;
	padding:10px 0;
	text-align: center;
	border-bottom:1px solid #e4e4e4;
}
.detail-title-mark{
	display:flex;
	justify-content: flex-start;
	border-bottom:1px solid #eee;
	margin-top:10px;
	margin-left: 10px;
}
.detail-title{
	padding:10px 40px;

}
.bor{
	border-bottom:2px solid #086CA2;
}
.content1{
	position:absolute;
	left:400px;
}

.TimelineItemtime{
    font-size: 14px;
    font-weight: bold;
}
</style>
<style type="text/css">
 .content{
        padding-left: 5px;
        top:0!important;
    }
 .demo-spin-icon-load{
        animation: ani-demo-spin 1s linear infinite;
    }
 @keyframes ani-demo-spin {
    from { transform: rotate(0deg);}
    50%  { transform: rotate(180deg);}
    to   { transform: rotate(360deg);}
}
.el-upload--text{
	width:100%!important;
}
</style>