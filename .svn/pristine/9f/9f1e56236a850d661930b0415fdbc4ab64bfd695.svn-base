<template>
	<div class='addCrm'>
	<!--固定导航-->
	<div class="top">
		<div class="head">
			<!-- <Col span='6'> -->
				<div class="left-top">
					<p class="wldw">
						<span style="width:42px;font-weight:900">{{$t('public.screen')}}：</span>
						 <Select style="width:100px" v-model='valueT' :placeholder="$t('public.all')" @on-change="orderselected">
					        <Option v-for="item in orderListname" :value="item.value" :key="item.value">{{ item.label }}</Option>
					    </Select>
					</p>
					<div>
						<!--新建-->
						<span class="top-left-btn"  @click="add">
							<Icon type="plus" style="position:absolute;top:7px;left:8px"></Icon></span>

					</div>
				</div>
			<!-- </Col> -->
			<!-- <Col span='18'> -->
				<div style='position:absolute;left:360px;top:0px'>
					<span style="margin-left:10px;font-size:14px;font-weight:900">{{crmDetail.name}}</span>
				</div>
				<div class="right-top">
				<div style="margin-right:10px;">
					<div v-if="addText">
						<Button shape="circle"  style="background:#3b77e3;margin-right:5px;color:#fff;border:none" @click="saveCgInfo('formValidate')" >
						<Icon type="checkmark-round" style=";margin-right:5px;color:#fff"></Icon>{{$t('public.SaveBtn')}}</Button>

						<Button shape="circle"  @click="addCancel"  style="background:#999999;color:#fff;margin-right:10px;" ><Icon type="close" style="margin-right:5px;"></Icon>{{$t('public.cancel')}}</Button><!--取消-->

						<span @click="cancelHome" style="cursor:pointer;margin-right:15px"><Icon type="close" class="cha" ></Icon></span>
					</div>

					<div v-if="!addText" class="changebutton">

						<Button type="ghost"  shape="circle"  @click="edit" v-if="editshow" style="background:#40ca98;margin-right:5px;color:#fff;border:none">
							<Icon type="edit" style="position:relative;right:5px"></Icon>
						{{$t('public.EditBtn')}}<!--修改-->
						</Button>

						<Button type="ghost"  shape="circle" @click="saveEdit('formValidate1')" v-if="!editshow" style="background:#3b77e3;margin-right:5px;color:#fff;border:none">
							<Icon type="checkmark-round" style=";margin-right:5px;color:#fff"></Icon>{{$t('public.SaveBtn')}}
						</Button>
						<Button shape="circle" v-if="!editshow"  @click="editCancel"  style="background:#999999;color:#fff;" ><Icon type="close" style="margin-right:5px;"></Icon>{{$t('public.cancel')}}</Button>

						<!-- 更多-->
			            <Dropdown trigger="click" style="margin-left: 4px" v-if='editshow'>
			                  <Button shape="circle" type="ghost" style="background:#ff7d16;color:#fff;border:none">{{$t('public.more')}}
			                  <span><i class="ivu-icon ivu-icon-chevron-down"></i></span>
			              </Button>

			              <DropdownMenu slot="list">
			                  <span  @click="start"><DropdownItem >{{$t('public.start')}}</DropdownItem></span>
			                  <span  @click="stop"><DropdownItem >{{$t('public.stop')}}</DropdownItem></span>
			                  <span  @click="del"><DropdownItem >{{$t('public.del')}}</DropdownItem></span>

			              </DropdownMenu>
			           </Dropdown>
						<span @click="cancelHome" style="cursor:pointer;margin:0 15px 0 10px" ><Icon type="close" class="cha" ></Icon>
						</span>
					</div>
				</div>
				</div>
			<!-- </Col> -->
		</div>
	</div>
		 <div style='height:60px;width:100%;'></div>
		 <div style='display:flex;height:50%'>
			<!--左侧列表-->
			<div class="left-content">
				<div class='locationSearch'>
					<Input style='padding:10px 20px' v-model='searchKeyword' :placeholder="$t('public.nameandphone')" @on-enter='enterSearch'>
	                <span slot="append"  @click='search' style='cursor:pointer;'>{{$t('public.search')}}</span>
	                </Input>
				</div>
				<p v-if="Allcrm.length==0" class='scrollFix'>
					<Spin>
		                <!-- <Icon type="load-c" size=18 class="demo-spin-icon-load"></Icon> -->
		                <div>{{$t('public.NoData')}}</div>
		            </Spin>
			    </p>
				<Scroll :on-reach-bottom="handleReachEdge" :height="height" v-else >
					<div class="con-list" v-for="(item,index) in Allcrm" @click="getcginfo(item.id,index)" :class="{bg:numIndex==index}">
						  <span class='left-img'>
						 	 <img :src="item.headPic" width='60' height='60'>
						 </span>

						 <div>
						<p class="list-title">{{item.name}}</p>
						<p style='position: absolute;right: 10px;top: 57px;'>{{item.accountName}}</p>
						<p class="txt" style="margin-top:10px;">
							{{item.phone}}
							<span style='margin-left:4px'
					:class="{colorGender1:item.gender==1,colorGender0:item.gender==0}">{{item.gender}}</span>
						</p>

						<span class="date">{{item.createTime}}</span>
						<div class="lanrenLeft" :class="{bgd4:item.status==1,bgd5:item.status==0,bgd6:item.status==99}">
	                               <span >{{item.statusDesc}}</span>
	                            </div>​
						</div>
					</div>

				</Scroll>
			</div>
			<!--右侧-->
			<div class="add-right" >
				<div class='right-left' v-if='leftphoto' style='position:relative'>
					<div >
	                    <el-upload
						  class="avatar-uploader"
						  :action="logoUrl"
						  name='file'
						  :show-file-list="false"
						  
						  :before-upload="beforeAvatarUpload"
						  :on-success="addsucess"
						  accept="image/*"
						  >
						  <img v-if="photo" :src="photo" class="avatar" width='80' height='80'>
						  <i v-else class="el-icon-plus avatar-uploader-icon"></i>
						</el-upload>
						
	                </div>
	              
				</div>
				<!--新增-->
				<div class='right-right' v-if='addText'>
					<Form ref="formValidate" :model="formValidate" :rules="ruleValidate" :label-width="120">

						<div style='display:flex;height: 100%;'>
						<div style='width:50%'>
							<FormItem :label="$t('manage.ey.loginTitle')" prop="accountName">
			                	<Input v-model="formValidate.accountName" :placeholder="$t('manage.ey.loginTitle')"></Input>
			           		</FormItem>
							<FormItem :label="$t('manage.ey.name')" prop="name">
			                	<Input v-model="formValidate.name" :placeholder="$t('manage.ey.name')"></Input>
			           		</FormItem>
							<FormItem :label="$t('manage.ey.mobile')" prop="phone">
			                	<Input v-model="formValidate.phone" :placeholder="$t('manage.ey.mobile')"></Input>
			           		</FormItem>
			           		<FormItem :label="$t('manage.ey.personJ')" prop="emergencyContact">
		                		<Input v-model="formValidate.emergencyContact" :placeholder="$t('manage.ey.personJ')"></Input>
		           			</FormItem>
							<!-- <FormItem :label="$t('manage.ey.loginTitleRole')" prop="roleId">
		                	<Input v-model="formValidate.roleId" :placeholder="$t('manage.ey.loginTitleRole')"></Input>
		           			</FormItem> -->
		           			<FormItem :label="$t('manage.ey.loginTitleRole')" prop="roleId">
								<!-- <span @click='clickRole'>
		                			<Input v-model="formValidate.roleName" :placeholder="$t('manage.ey.loginTitleRole')"></Input>
		                		</span> -->

								<Select  @on-change="getrolelevel" v-model='roleleveid'>
	                                <Option v-for="(item,index) in rolelevel" :value='item.value' :key="index">
	                                	{{ item.label }}
	                            	</Option>
	                            </Select>
		           			</FormItem>
		           		</div>
						<div style='width:50%'>
						<FormItem :label="$t('manage.ey.loginTitlePSS')" prop="accountPs">
		                	<Input v-model="formValidate.accountPs" type='password'  :placeholder="$t('manage.ey.loginTitlePSS')"></Input>
		           		</FormItem>
						<FormItem :label="$t('public.gender')" >
		                	<RadioGroup v-model="gender" @on-change="selsectedSex">
							        <Radio label="1">
							            <span>{{$t('public.man')}}</span><!--男-->
							        </Radio>
							        <Radio label="0">
							            <span>{{$t('public.woman')}}</span>
							        </Radio>
							    </RadioGroup>
		           		</FormItem>

						<FormItem :label="$t('manage.ey.email')" prop="email">
		                	<Input v-model="formValidate.email" :placeholder="$t('manage.ey.email')"></Input>
		           		</FormItem>
		           		<FormItem :label="$t('manage.ey.position')">
			                	 <Select  @on-change="getlevel" v-model='category'>
	                                <Option v-for="(item,index) in storelevel" :value='item.value' :key="index">
	                                	{{ item.label }}
	                            	</Option>
	                            </Select>
			           		</FormItem>
		           		</div>
		           		</div>
		           		<FormItem :label="$t('public.address')"><!--地址-->
							<div style='display:flex;width:100%'>

							<Input  v-model='address' :placeholder="$t('public.address')"></Input>
							</div>
		           		</FormItem>
					</Form>

				</div>
				<!--修改-->
				<div class='right-right' v-if='xiugai'>
					<Form ref="formValidate1" :model="formValidate" :rules="ruleValidate" :label-width="120">

						<div style='display:flex'>
						<div style='width:50%'>
							<FormItem :label="$t('manage.ey.loginTitle')" prop="accountName">
			                	<Input v-model="formValidate.accountName"  :placeholder="$t('manage.ey.loginTitle')"></Input>
			           		</FormItem>
							<FormItem :label="$t('manage.ey.name')" prop="name">
			                	<Input v-model="formValidate.name" :placeholder="$t('manage.ey.name')"></Input>
			           		</FormItem>
							<FormItem :label="$t('manage.ey.mobile')" prop="phone">
			                	<Input v-model="formValidate.phone" :placeholder="$t('manage.ey.mobile')"></Input>
			           		</FormItem>
			           		<FormItem :label="$t('manage.ey.personJ')" prop="emergencyContact">
		                		<Input v-model="formValidate.emergencyContact" :placeholder="$t('manage.ey.personJ')"></Input>
		           			</FormItem>
							<FormItem :label="$t('manage.ey.loginTitleRole')" prop="roleId">
								<!-- <span @click='clickRole'>
		                			<Input v-model="formValidate.roleName" :placeholder="$t('manage.ey.loginTitleRole')"></Input>
		                		</span> -->
								<Select  @on-change="getrolelevel" v-model='roleleveid'>
	                                <Option v-for="(item,index) in rolelevel" :value='item.value' :key="index">
	                                	{{ item.label }}
	                            	</Option>
	                            </Select>
		           			</FormItem>
		           		</div>
						<div style='width:50%'>
						<!-- <FormItem :label="$t('manage.ey.loginTitlePSS')" prop="accountPs">
		                	<Input v-model="formValidate.accountPs" :placeholder="$t('manage.ey.loginTitlePSS')"></Input>
		           		</FormItem> -->
						<FormItem :label="$t('public.gender')" >
		                	<RadioGroup v-model="gender" @on-change="selsectedSex">
							        <Radio label="1">
							            <span>{{$t('public.man')}}</span><!--男-->
							        </Radio>
							        <Radio label="0">

							            <span>{{$t('public.woman')}}</span>
							        </Radio>

							    </RadioGroup>
		           		</FormItem>

						<FormItem :label="$t('manage.ey.email')" prop="email">
		                	<Input v-model="formValidate.email" :placeholder="$t('manage.ey.email')"></Input>
		           		</FormItem>
		           		<FormItem :label="$t('manage.ey.position')">
			                	 <Select  @on-change="getlevel" v-model='category'>
	                                <Option v-for="(item,index) in storelevel" :value='item.value' :key="index">
	                                	{{ item.label }}
	                            	</Option>
	                            </Select>
			           		</FormItem>
		           		</div>
		           		</div>
		           		<FormItem :label="$t('public.address')"><!--地址-->
							<div style='display:flex;width:100%'>

							<Input  v-model='address' :placeholder="$t('public.address')"></Input>
							</div>
		           		</FormItem>
					</Form>
				</div>
				<!--详情-->
				<!--详情明细订单页面-->
					<div class="right-content right-detail" ref="detail" style="display:none">
						<div >

						<div style='display:flex'>
							<div style="flex:0 0 178px;width:178px;height:178px"><img :src="crmDetail.headPic"  style='vertical-align:middle;width:100%;height:100%'></div>
							
							<Form :label-width="120" style="width: 100%;margin: 0 10px;height: 100%;">

								<div style='display:flex;height: 100%;'>
								<div style='width:50%'>
									<FormItem :label="$t('manage.ey.loginTitle')" >
					                	<Input disabled v-model="formValidate.accountName" :placeholder="$t('manage.ey.loginTitle')"></Input>
					           		</FormItem>
									<FormItem :label="$t('manage.ey.name')">
					                	<Input disabled v-model="formValidate.name" :placeholder="$t('manage.ey.name')"></Input>
					           		</FormItem>
									<FormItem :label="$t('manage.ey.mobile')">
					                	<Input disabled v-model="formValidate.phone" :placeholder="$t('manage.ey.mobile')"></Input>
					           		</FormItem>
					           		<FormItem :label="$t('manage.ey.personJ')">
				                		<Input disabled v-model="formValidate.emergencyContact" :placeholder="$t('manage.ey.personJ')"></Input>
				           			</FormItem>
									<!-- <FormItem :label="$t('manage.ey.loginTitleRole')" prop="roleId">
				                	<Input v-model="formValidate.roleId" :placeholder="$t('manage.ey.loginTitleRole')"></Input>
				           			</FormItem> -->
				           			<FormItem :label="$t('manage.ey.loginTitleRole')" prop="roleId">
										<!-- <span @click='clickRole'>
				                			<Input v-model="formValidate.roleName" :placeholder="$t('manage.ey.loginTitleRole')"></Input>
				                		</span> -->

										<Select disabled v-model='roleleveid' >
			                                <Option v-for="(item,index) in rolelevel" :value='item.value' :key="index">
			                                	{{ item.label }}
			                            	</Option>
			                            </Select>
				           			</FormItem>
				           		</div>
								<div style='width:50%'>
								<!-- <FormItem :label="$t('manage.ey.loginTitlePSS')" prop="accountPs">
				                	<Input disabled v-model="formValidate.accountPs" type='password'  :placeholder="$t('manage.ey.loginTitlePSS')"></Input>
				           		</FormItem> -->
								<FormItem :label="$t('public.gender')" >
				                	<RadioGroup v-model="gender" @on-change="selsectedSex">
									        <Radio disabled label="1">
									            <span>{{$t('public.man')}}</span><!--男-->
									        </Radio>
									        <Radio disabled label="0">
									            <span>{{$t('public.woman')}}</span>
									        </Radio>
									    </RadioGroup>
				           		</FormItem>

								<FormItem :label="$t('manage.ey.email')" prop="email">
				                	<Input disabled v-model="formValidate.email" :placeholder="$t('manage.ey.email')"></Input>
				           		</FormItem>
				           		<FormItem :label="$t('manage.ey.position')">
					                	 <Select disabled v-model='category'>
			                                <Option v-for="(item,index) in storelevel" :value='item.value' :key="index">
			                                	{{ item.label }}
			                            	</Option>
			                            </Select>
					           		</FormItem>
				           		</div>
				           		</div>
				           		<FormItem :label="$t('public.address')"><!--地址-->
									<div style='display:flex;width:100%'>

									<Input disabled v-model='address' :placeholder="$t('public.address')"></Input>
									</div>
				           		</FormItem>
							</Form>
						</div>
					
					</div>
					<ul class="detail-title-mark" style='margin-top:20px'>
                        <li v-for="(item,index) in detailsArr" class="detail-title" @click="addborderdefails(index)" :class="{bor:index==num5}">
                            {{item}}
                        </li>
                    </ul>
                    <div v-if='num5==0' style='margin-top:10px'>
                    	<Table borderhighlight-row :columns="warehouseskey" :data="warehouses" ></Table>
                    </div>
				</div>
			</div>
		</div>

		<div class='tot'>
	        <span>共<span style='color:#ff0000'> {{total}} </span>条</span>
	        <span>当前第<span style='color:#ff0000'> {{current}} </span>页</span>
	    </div>
	</div>
</template>
<script type="text/javascript">
import LoadUrl from '@/components/common/actionLoad'
 import { regionData,CodeToText,TextToCode} from 'element-china-area-data'//地址选择数据
	export default{
		data(){
			return{
				detailsArr:['关联店铺'],
				num5:0,
				warehouseskey:[

                    {
                        title:"Logo",
                        width:80,
                        key:"logDesc",
                        render:(h, params) =>{
                            return h('div',[
                                h('img',{
                                    attrs:{
                                        src:params.row.logDesc
                                    },
                                    style:{
                                        width:'40px',
                                        height:'40px'
                                    }
                                })
                            ])
                        }
                    },
                    {
                        title:this.$t('manage.store.Code'),//"编码",
                      
                        key:"code"
                    },
                    {
                        title:this.$t('manage.store.Name'),//"名称",
                       
                        key:"name"
                    },
                     
                     {
                        title:this.$t('manage.store.Person'),//"联系人",
                        ellipsis:true,
                        key:"person"
                    },
                    {
                        title:this.$t('manage.store.Mobile'),//"手机",
                       
                        key:"phone"
                    },
                     {
                        title:this.$t('manage.store.time'),//"营业时间",
                        
                        key:"businessHours"
                    },
                    {
                        title:this.$t('manage.store.Address'),//"地址",
                        
                        key:"ContentAddress"
                    },
                     {
                        title:this.$t('public.status'),//"状态",
                        ellipsis:true,
                        width:120,
                        key:"statusDesc",
                        render:(h,params)=>{
                            return h('span',{
                                style:{
                                    color:params.row.status==1?'#40ca98':params.row.status==0?'#3b77e3':params.row.status==99?'#d53c39':params.row.status==9999?"#d53c39":""
                                }
                            },params.row.statusDesc)
                        }
                    },
                ],
				warehouses:[],

				searchKeyword:"",
				storelevel:[],//职位数组
				category:"",//职位
				CodeToText:CodeToText,//code转为Text
				TextToCode:TextToCode,//Text转为code
				cityInfo:regionData,//地址数据
				selectedOptions2:[],//地址绑定的数据
				addoredit:"新增用户",

				rolelevel:[],//角色
				roleleveid:"",
				rowRole:{},
				rolekey:[
					{
						title:"名称",
						key:"name",
					},
					{
						title:"描述",
						key:"description",
					},
				],
				roletotal:0,//角色
				rolepagesize:0,//角色
				roleisshow:false,
				formValidate:{
					name:'',//昵称
					phone:'',//手机号
					accountName:'',//账号名称
					accountPs:'',//密码
					email:'',
					emergencyContact:"",//紧急联系人
					roleId:"",//开户角色
					roleName:"",//开户角色名称
				},
				ruleValidate:{
					accountName:[{ required: true, message: '开户帐号不能为空', trigger: 'blur' },{ pattern:/^[A-Za-z\d_\-\u4e00-\u9fa5]{1,20}$/, message: '存在非法字符或超过指定长度20个字符' }],
					accountPs:[{ required: true, message:this.$t('public.pssEmpty'), trigger: 'blur' },{ pattern:/^[A-Za-z\d_\-\u4e00-\u9fa5]{6,20}$/, message: '存在非法字符或超过指定长度6到20个字符' }],
					email:[{type:"email", message: '请输入正确的邮箱' }],
					name:[{ required: true, message: '用户名称不能为空', trigger: 'blur' }],
					
					phone:[
					{ pattern:/^1[3|4|5|7|8][0-9]{9}$/, message: '请输入正确的手机号码' }//
					]//匹配印度尼西亚和中国{最少7位，最大9位}
				},
				logoUrl:LoadUrl.httpPrefix.Url+'file/action/upload/image/url?c=员工图片&uid='+this.$store.state.common.token,
				leftphoto:true,
				photo:'',
				xiugai:false,
				current:1,
				total:0,
				pageSize:0,
				height:'',
				numIndex:0,
				indexId:'',
				addText:true,
				editshow:false,
				storeisshow:false,
				crmCardisshow:false,
				storekeyword:'',
				cartype:'',
				num2:0,
				orderdataList:[],
				titles:["基本信息"],//,"订单","积分","充值历史","消费历史"
				crmDetail:{},
				Allcrm:[],
				uid: this.$store.state.common.token,
				valueT:1,
                orderListname:[
                    {
                        label:'全部',
                        value:0
                    },
                    {
                        label:this.$t('public.normal'),//正常
                        value:1
                    },
                    {
                        label:this.$t('public.normalT'),//"已停用",
                        value:99
                    },
                ],
				value:'',
				email:'',
				remark:'',
				gender:'1',//
				address:'',
				province: '', //省
				city: '', //市
				country: '', //区country
			}
		},
		methods:{
			//点击新增
			add(){
				this.addoredit='新增用户'
				this.addText = true
				this.xiugai=false
				this.leftphoto=true
				this.$refs.detail.style.display='none'

				this.formValidate.accountName=''
				this.formValidate.accountPs=''
				this.photo=''
				this.formValidate.name=''//会员名
				this.formValidate.phone ='' //手机号
				this.formValidate.email =''
				this.address=''//地址
				this.gender='1'
				this.email=''
				this.remark=''
				this.formValidate.emergencyContact=''
			},

			//点击新增取消
			addCancel(){
				this.add()
			},

			//新建点击完成POST /employee/add 增加用户
			saveCgInfo(name){
				this.$refs[name].validate((valid) => {
					if(valid){
						this.axios.post('/employee/add?uid='+this.uid,{
							accountName:this.formValidate.accountName,
							accountPs:this.formValidate.accountPs,
							emergencyContact:this.formValidate.emergencyContact,//紧急联系人
							roleId:this.roleleveid,//开户角色
							headPic:this.photo,
							name:this.formValidate.name,//用户员名
							phone:this.formValidate.phone,//手机号
							address:this.address,
							email:this.formValidate.email,
							gender:this.gender,
							positionId:this.category,//职位
					}).then((res)=>{

						if(res.data.status==200){
							this.$notify({
		                        title:"",//
		                        message:'新建用户成功',
		                        type: 'success',
		                        position: 'bottom-right'
							});
							this.getMentList(this.valueT)
							this.formValidate.accountName=''
							this.formValidate.accountPs=''
							this.photo=''
							this.formValidate.name=''//会员名
							this.formValidate.phone ='' //手机号
							this.formValidate.email =''
							this.address=''//地址
							this.gender='1'
							this.email=''
							this.remark=''
							this.gender='1'
							this.category=''
							this.formValidate.roleId=''//开户角色
							this.selectedOptions2=[]
							this.roleleveid=''
						}else{
							this.$notify({
		                        title:"",//
		                        message:res.data.errorMessage,
		                        type: 'error',
		                        position: 'bottom-right'
		                    });
						}
					})
					}
				})
			},
			//取消修改
			editCancel(){
				this.formValidate.accountName=''
				this.formValidate.accountPs=''
				this.photo=''
				this.formValidate.name=''//会员名
				this.formValidate.phone ='' //手机号
				this.formValidate.email =''
				this.address=''//地址
				this.gender='1'
				this.email=''
				this.remark=''
				this.gender='1'
				this.category=''
				this.selectedOptions2=[]
				this.addText = false
				this.xiugai=false
				this.editshow=true
				this.leftphoto=false
				this.$refs.detail.style='block'
				this.formValidate.emergencyContact=''
				this.formValidate.roleId=''//开户角色
				this.roleleveid=''
			},
			//点击修改
			edit(){
				this.$refs.detail.style.display='none'
				this.editshow=false
				this.xiugai=true
				this.leftphoto=true
				this.addoredit='修改用户'
				this.getCrmDetail(this.indexId)
			},
			//保存修改
			saveEdit(name){
				this.$refs[name].validate((valid) => {
					if(valid){
						this.axios.put('employee/update?uid='+this.uid,{
							id:this.indexId,
							accountName:this.formValidate.accountName,
							headPic:this.photo,
							name:this.formValidate.name,//用户员名
							phone:this.formValidate.phone,//手机号
							address:this.address,
							email:this.formValidate.email,
							gender:this.gender,
							emergencyContact:this.formValidate.emergencyContact,//紧急联系人
							roleId:this.roleleveid,//开户角色
							positionId:this.category
					}).then(res=>{
						if(res.data.status==200){

							this.$notify({
		                        title:"",//
		                        message:this.$t('public.editSuccess'),//
		                        type: 'success',
		                        position: 'bottom-right'
		                    });
							this.formValidate.accountName=''
							this.formValidate.accountPs=''
							this.photo=''
							this.formValidate.name=''//会员名
							this.formValidate.phone ='' //手机号
							this.formValidate.email =''
							this.address=''//地址
							this.roleleveid=''
							this.email=''
							this.remark=''
							this.gender='1'
							this.selectedOptions2=[]
							this.formValidate.roleId=''//开户角色
							this.addText = false
							this.xiugai=false
							this.editshow=true
							this.leftphoto=false
							this.$refs.detail.style.display='block'
							this.getMentList(this.valueT)
							this.getCrmDetail(this.indexId)
						}else{
							this.$notify({
		                        title:"",//
		                        message:res.data.errorMessage,
		                        type: 'error',
		                        position: 'bottom-right'
		                    });
						}
					})
					}
				})
			},
			//点击差号
			cancelHome(){
				this.$router.push('/ey')
			},
			//单击左侧列表
			getcginfo(id,index){
				this.numIndex = index
				this.indexId = id
				this.addText = false
				this.xiugai=false
				this.editshow=true
				this.leftphoto=false
				this.addoredit='用户详情'
				this.$refs.detail.style.display='block'
				this.getCrmDetail(id)
			},
			//获取员工详情
			getCrmDetail(id){
				this.axios.get('employee/get/'+id+'?uid='+this.uid).then(res=>{
					if(res.data.status==200){
						console.log(res.data.rows)
						this.crmDetail=res.data.rows
						this.crmDetail.createTime=new Date(this.crmDetail.createTime).toLocaleDateString().replace(/\//g,'-')
						this.formValidate.accountName=res.data.rows.accountName
						this.formValidate.name=res.data.rows.name
						this.photo=res.data.rows.headPic
						this.formValidate.phone=res.data.rows.phone//手机号
						this.address=res.data.rows.address
						this.formValidate.email=res.data.rows.email
						this.formValidate.emergencyContact=res.data.rows.emergencyContact
						this.category=res.data.rows.positionId
						this.formValidate.roleId=res.data.rows.roleId//开户角色
						this.roleleveid=res.data.rows.roleId
						if(res.data.rows.warehouses==null || res.data.rows.warehouses.length==0){
							this.warehouses=[]
						}else{
							this.warehouses=res.data.rows.warehouses
							this.warehouses.forEach((x)=>{
	                            if(x.status==1){
	                                x.statusDesc=this.$t('public.normal')
	                            }
	                            if(x.status==99){
	                                x.statusDesc=this.$t('public.normalT')
	                            }
	                            if(x.status==0){
	                                x.statusDesc=this.$t('public.addnew')
	                            }
	                             if(x.status==9999){
	                                x.statusDesc=this.$t('public.del')
	                            }
	                            if(x.logo==null || x.logo==''){
	                                x.logDesc=''
	                            }else{
	                                x.logDesc=x.logo.split(',')[0]
	                            }
	                            x.ContentAddress=x.province+x.city+x.address

	                        })
						}
						this.gender=String(res.data.rows.gender)
						if(this.crmDetail.gender==1){
							this.crmDetail.gender='男'
						}else if(this.crmDetail.gender==0){
							this.crmDetail.gender='女'
						}

					}
				})
			},
			 //下拉框选择

			orderselected(value){
				this.valueT = value
				this.getMentList(this.valueT)
			},
			//地址
			//省市区
			handleChange(arr){

				this.province = this.CodeToText[arr[0]]
				this.city =this.CodeToText[arr[1]]
				this.country = this.CodeToText[arr[2]]
				console.log(this.selectedOptions2)

            },

			//下拉加载更多
            handleReachEdge(){
				this.current++//默认10条
    	 		this.axios.get('employee/query?offset='+this.current+'&uid='+this.uid+'&status='+this.valueT).then((res)=>{
	 				if(this.current>Math.ceil(this.total/this.pageSize)){
	 						this.current=Math.ceil(this.total/this.pageSize)
	 					}
			 		res.data.rows.forEach((item)=>{

			 			this.Allcrm.push(item)
			 			this.Allcrm.forEach((x,index)=>{
			 				if(x.gender==1){
								x.gender=this.$t('public.man')//'男'
								}
                            if(x.gender==0){
                                x.gender=this.$t('public.woman')//'女'
                            }
							x.createTime=new Date(x.createTime).toLocaleDateString().replace(/\//g,'-')
						})
			 		})

			 	})

            },

            //选择性别
            selsectedSex(label){
            	this.gender = label
            	console.log(this.gender)
            },
             //上传时
            // onprogress(event, file, fileList){
            //     this.loadingisshow=true
            // },
            //上传前
            beforeAvatarUpload(file) {
                const isJPG = file.type === 'image/jpeg';
                const isPng = file.type === 'image/png';
                const isLt2M = file.size / 1024 / 1024 < 2;
                if (!isJPG && !isPng) {
                      this.$notify({
                        title: "",//'失败',
                        message:this.$t('public.upJpngOrPng'),
                        type: 'error',
                        position: 'bottom-right'
                    });
                }
                if (!isLt2M) {
                     this.$notify({
                        title: "",//'失败',
                        message:this.$t('public.upJpngTwoM'),
                        type: 'error',
                        position: 'bottom-right'
                    });
                }
                return isJPG || isPng && isLt2M;
              },
             //上传图片成功
            addsucess(res,file){
            	if(res.status==200){
            		
            		this.photo=res.rows.url
            	}else{
            		
            		this.$notify({
                        title: "",//'失败',
                        message:"上传失败",
                        type: 'error',
                        position: 'bottom-right'
                    });
            	}
                

            },
            del(){
            	if(this.indexId==''){
             		this.$notify({
                        title:"",//
                        message:this.$t('public.errorOneData'),
                        type: 'error',
                        position: 'bottom-right'
                    });
             	}else{
             		this.$Modal.confirm({
                            title: '删除员工',
                            content: '<p>确定要删除吗?</p>',
                            onOk: () => {
                                this.axios.delete('employee/delete/'+this.indexId+'?uid='+this.uid).then((res)=>{
				            		if(res.data.status==200){
				            			this.$notify({
						                        title:"",//
						                        message:this.$t('public.deleteSuccess'),//
						                        type: 'success',
						                        position: 'bottom-right'
						                    });
				            			this.getMentList(this.valueT)
				            		}else{
				            			this.$notify({
					                        title:"",//
					                        message:res.data.errorMessage,
					                        type: 'error',
					                        position: 'bottom-right'
					                    });
				            		}
				            	})
                            },
                        });
             		
             	}
            },
             stop(){
            	if(this.indexId==''){
             		this.$notify({
                        title:"",//
                        message:this.$t('public.errorOneData'),
                        type: 'error',
                        position: 'bottom-right'
                    });
             	}else{
             		this.axios.post('employee/disabled/'+this.indexId+'?uid='+this.uid).then((res)=>{
	            		if(res.data.status==200){

	            			this.$notify({
			                        title:"",//
			                        message:this.$t('public.normalT'),
			                        type: 'success',
			                        position: 'bottom-right'
			                    });
	            			this.getMentList(this.valueT)
	            		}else{
	            			this.$notify({
			                        title:"",//
			                        message:res.data.errorMessage,
			                        type: 'error',
			                        position: 'bottom-right'
			                    });
	            		}
	            	})
             	}
            },
             start(){
             	if(this.indexId==''){
             		this.$notify({
                        title:"",//
                        message:this.$t('public.errorOneData'),
                        type: 'error',
                        position: 'bottom-right'
                    });
             	}else{
             		this.axios.post('employee/enabled/'+this.indexId+'?uid='+this.uid).then((res)=>{
	            		if(res.data.status==200){

	            			this.$notify({
			                        title:"",//
			                        message:this.$t('public.normalS'),
			                        type: 'success',
			                        position: 'bottom-right'
			                    });
	            			this.getMentList(this.valueT)
	            		}else{
	            		this.$notify({
		                        title:"",//
		                        message:res.data.errorMessage,
		                        type: 'error',
		                        position: 'bottom-right'
		                    });
	            		}
	            	})
             	}
            },
            //添加下边框
			// addborder(index){
			// 	this.num2 = index

			// 	if(index==1){
			// 		this.axios.get('crm/order?uid='+this.uid).then(res=>{
			// 			if(res.data.status==200){
			// 				this.orderdataList = res.data.rows
			// 				this.total=res.data.total;
			// 				this.pageSize = res.data.pageSize
			// 			}
			// 		})
			// 	}

			// },


			 //切换一条页
      //       getData(current){
      //           this.axios.get('crm/order?offset='+current+'&uid='+this.uid).then((res)=>{
      //               //console.log(res)
      //               this.orderdataList = res.data.rows
      //               this.orderdataList.forEach((x,index)=>{

						// 	x.createTime=new Date(x.createTime).toLocaleDateString().replace(/\//g,'-')
						// })
      //           })
      //       },
      //       //翻页
      //       changePageSize(size){
      //           this.pageSize = size
      //       },
      		search(){
      			this.axios.get('employee/query?uid='+this.uid+'&keyword='+this.searchKeyword).then((res)=>{
	            	console.log(this.Allcrm)
	                if(res.data.status==200){
	                	this.Allcrm = res.data.rows
	                	this.total=res.data.total
            			this.pageSize=res.data.pageSize
	                }
		               this.Allcrm.forEach((x)=>{
		               	if(x.gender==1){
								x.gender=this.$t('public.man')//'男'
								}
                            if(x.gender==0){
                                x.gender=this.$t('public.woman')//'女'
                            }
		               	x.createTime = new Date(x.createTime).toLocaleDateString().replace(/\//g,'-')
		               })
	            })
      		},
      		enterSearch(){
      			this.search()
      		},
			//获取所用户
	        getMentList(s){
	            this.axios.get('employee/query?uid='+this.uid+'&status='+s).then((res)=>{
	            	console.log(this.Allcrm)
	                if(res.data.status==200){
	                	this.Allcrm = res.data.rows
	                	this.total=res.data.total
            			this.pageSize=res.data.pageSize
	                }
		               this.Allcrm.forEach((x)=>{
		               	if(x.gender==1){
								x.gender=this.$t('public.man')//'男'
								}
                            if(x.gender==0){
                                x.gender=this.$t('public.woman')//'女'
                            }
		               	x.createTime = new Date(x.createTime).toLocaleDateString().replace(/\//g,'-')
		               })
	            })
	        },
	        //获取GET /position/query 职位管理
	        getLevel(){
	        	 this.axios.get('position/query?length=99&uid='+this.uid).then(res=>{
                    if(res.data.status==200){
                        res.data.rows.forEach((x,index)=>{
                        	let arr={
	                        	label:res.data.rows[index].name,
	                        	value:res.data.rows[index].id,
	                        }
	                        this.storelevel.push(arr)
                        })
                        console.log(this.storelevel)

                    }
                })

	        },
	        //选择职位
	        getlevel(v){
	        	console.log(v)
	        	this.category=v
			},
			//选择角色
			getrolelevel(v){
				this.roleleveid=v
				console.log(v)
				this.formValidate.roleId=v

			},
	        //获取角色GET /role/listRole 角色列表
	        getRole(){
	        	this.axios.get('/role/query?uid='+this.uid).then(res=>{
	        		if(res.data.status==200){
						console.log(res.data.rows)

						let data=res.data.rows
						data.forEach((x,index)=>{
							let arr={
								label:data[index].name,
								value:data[index].id
							}
							this.rolelevel.push(arr)
						})

	        		}
	        	})
	        },
		},
		created(){
			this.$nextTick(()=>{
				this.getMentList(this.valueT)
				this.getLevel()//获取职位
				this.getRole()//获取角色
			})

		},
		mounted(){
			if(this.$route.query.id){
				this.indexId = this.$route.query.id
				this.numIndex = this.$route.query.index
				this.valueT=this.$route.query.s
				this.getcginfo(this.indexId,this.numIndex)
			}
			this.height = document.documentElement.clientHeight
			// this.handleReachEdge()//滚动加载
			window.onresize=function(){
				this.height = document.documentElement.clientHeight
			}
		}
	}
</script>
<style type="text/css" scoped>
.lanrenLeft{
    position: absolute;
    text-align: center;
    top: 0px;
    right: 0px;
    width: 0;
    height: 0;
    border-top:40px solid #d53c39;
    border-left:40px solid transparent;
}
.lanrenLeft span{
width: 40px;
    height: 23px;
    color: #fff;
    display: block;
    position: relative;
    z-index: 9999999999999;
    top: -36px;
    right: 36px;
    font-size: 12px;
     font-weight: 100;
    transform: rotate(46deg);
}
.bgd4{
    border-top:40px solid #40ca98;
}
/*状态的颜色 新增*/
.bgd5{
    border-top:40px solid #40ca98;
}
/*状态的颜色 已停用*/
.bgd6{
    border-top:40px solid #d53c39;
}
.tot{
    position:fixed;
    bottom:10px;
    left:15%;
    z-index:12;
}
.head{
	height:60px;
	background: #fff;
	width: 100%;
    position: relative;
    z-index:9;
	border-bottom:1px solid #eee;
}
.left-top{
	height: 60px;
	width:360px;
	flex:0 0 360px;
	line-height: 60px;
	position:fixed;
	z-index:9;
	display:flex;
	background: #fff;
	padding-right:10px;
	border-bottom:1px solid #eee;
	border-right:1px solid #eee;
	justify-content: space-between;
}
.top{
    display:flex;
    height:60px;
    line-height: 60px;
    position:fixed;
    width:100%;
    z-index:9;
    background: #fff;
   border-bottom:1px solid #eee;
    }
.right-top{
	height: 60px;
	border-bottom: 1px solid #e4e4e4;
	line-height: 60px;
	position:absolute;
	right:115px;
	z-index:10;
	display:flex;

	background: #fff;
	justify-content: space-between;

}
.colorGender1{
	color:#72B7EA;
}
.colorGender0{
	color:#FF934D;
}
.wldw{
	margin-left:10px;
}
.left-img{
    margin-right: 10px;
width: 60px;
height: 60px;
border-radius: 50%;
overflow: hidden;
/* margin-bottom: -8px; */
display: block;

line-height: 80px;
text-align: center;
}
.top-left-btn{
background: #3B77E3;
margin-right: 10px;
color: #fff;
border: none;
width: 26px;
height: 26px;
border-radius: 26px;
display: inline-block;
position: relative;
top: 12px;
}
.top-left-btn1{
background: #FF7D16;
}
.top-left-btn:hover{
cursor:pointer;
}
.left-content {
	height:100%;
	width:360px;
	flex:0 0 360px;

	margin-bottom:300px;

	border-right:1px solid #E6E6E6;
	position:fixed;
	background:#F9F9F9;
}
.con-list {
	display:flex;
	align-items: center;
	width: 100%;
	word-wrap:break-word;

	border-bottom: solid 1px #E6E6E6;
	padding:10px 25px;

	cursor: pointer;
	position:relative;
}
.con-list:hover{
	cursor:pointer;
}
.con-list .date{
	position:absolute;
	right:30px;
	top:30px;
}
.con-list .status{
	width:100px;

	text-align: center;
	position: absolute;
    right: 0px;
    top: 47px;
}
.con-list .list-title {
	color: #0d0d0d;
	font-size: 14px;
	position:relative;
	top:15px;
}
div.con-list:last-child{
	margin-bottom:300px
}
.con-list .txt {
	color: #585858;
	font-size: 12px;
	position:relative;
	top:15px;
}
.bg{
	background: #dbe5f1;
}
.add-right {
	width: 100%;
	background: #fff;
	height:100%;
	margin-left:380px;
	padding-right:20px;
	padding-top:10px;
	display:flex;
}
.list-box{
	display: flex;
	height:35px;
	line-height: 35px;
	margin:25px 10px;
}
.list-box1{
		margin:4px 10px;
}
.list-box span{
	height:40px;
	width:120px;
	text-align: right;

}
.list-box input.ivu-input{
	height:40px!important;
}
.list-box1{
	margin-left:20px;
}
.list-box1 span{
	width:auto;
	text-align: left
}
.right-left{
	width: 230px;
    margin-top: 26px;
	border: 1px dashed #d9d9d9;
	height:180px;
}
.right-right{
	width:100%;
}
.avatar-uploader .el-upload {
    border: 1px dashed #d9d9d9;
    border-radius: 6px;
    cursor: pointer;
    position: relative;
    overflow: hidden;

  }
  .avatar-uploader .el-upload:hover {
    border-color: #409EFF;
  }
  .avatar-uploader-icon {
    font-size: 28px;
    color: #8c939d;
    width: 178px;
    height: 178px;
    line-height: 178px;
    text-align: center;
  }
  .avatar {
    width: 178px;
    height: 178px;
    display: block;
  }
   .title{
    	display:flex;justify-content: space-between;margin-top:20px
    }
    .title:hover{
    	cursor:pointer;
    }
	.right-content{
		width: 100%;
		height:100%;
		/*	margin-bottom:100px;*/
	}
   li{
    list-style: none
}
.blackinfo li{
      list-style: none;
      margin:15px 0;
      display: flex;

    }
    .detail-top{
        margin-top:20px;
    }
    .blackinfo{
      margin-right:30px;
      width:33%;
    }
    .detail-top h4{
      color:#2B8F8F;
      width:60px;
      text-align: center;
      border-bottom:2px solid #2B8F8F;
    }
    .detail-top li span.info{
      width:67%;
    }
    .detail-top li span.blackinfo-left{
		color: #2B8F8F;
		/* margin: 0px 10px; */
		font-weight: 600;
		width: 100px;
		text-align: right;
    }
	.detail-bottom{
		margin-bottom: 120px
	}
	.detail-title-mark{
		display:flex;
		justify-content: flex-start;
		border-bottom:1px solid #eee;
		margin-top:1px;
		margin-left: 10px;
	}
	.detail-title{
		padding:10px 40px;

	}
	.table{

	}
	.page-box{
		margin-top:4px;
	}
	.detail-public{
		width:100%;
		margin:10px;
	}
	.bor{
		border-bottom:2px solid #086CA2;
	}
	.addressDetail{
		display: inline-block;

		height: 34px;
		margin-left:28px;
		text-indent: 10px;
		color: #555;
		background-color: #fff;
		background-image: none;
		border: 1px solid #eee;

		-webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
		box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
		-webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
		-o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
		transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
	}
</style>
<style type="text/css">
 .demo-spin-icon-load{
        animation: ani-demo-spin 1s linear infinite;
    }
 @keyframes ani-demo-spin {
    from { transform: rotate(0deg);}
    50%  { transform: rotate(180deg);}
    to   { transform: rotate(360deg);}
}
/*.el-upload--text{
	width:100%!important;
}*/
.el-input__inner{
	border: 1px solid #e4e4e4!important;
	height: 32px!important;
}

</style>
